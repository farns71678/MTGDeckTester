<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MTG Deck Builder - Create a new account</title>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>

    <style>
      @import url("https://fonts.googleapis.com/css2?family=Noto+Sans:ital,wght@0,100..900;1,100..900&family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&family=Share+Tech&display=swap");
      @import url("https://fonts.googleapis.com/css2?family=Nunito:ital,wght@0,200..1000;1,200..1000&display=swap");
      @import url("https://fonts.cdnfonts.com/css/liberation-mono");

      * {
        margin: 0;
        padding: 0;
        color: #e2e2e2;
        font-family: "Nunito", "Noto Sans", Arial, sans-serif;
        box-sizing: border-box;
      }

      body {
        width: 100vw;
        max-width: 100vw;
        height: 100vh;
        max-height: 100vh;
        display: flex;
        justify-content: center;
        background-color: #222;
      }

      #center-column {
        display: flex;
        height: 100%;
        flex-direction: column;
        justify-content: center;
      }

      #signup-form {
        padding: 15px;
        display: flex;
        flex-direction: column;
        align-items: center;
      }

      input[type="text"],
      input[type="email"],
      input[type="password"] {
        max-width: 360px;
        width: 360px;
        outline: none;
        border: 2px solid transparent;
        padding: 6px 8px;
        font-size: 15pt;
        background-color: #3a3a3a;
        transition: all 0.3s ease;
        font-weight: 600;
        font-size: 12pt;
        margin: 9px 10px 0px 10px;
        border-radius: 8px;
        color: #e2e2e2;
      }

      input:hover,
      input:focus {
        border-color: #bbb;
      }

      .form-err {
        width: 100%;
        padding: 3px 2px;
        font-size: 10pt;
        font-weight: 900;
        color: #ff2020;
        font-family: "Nunito", "Noto Sans", Arial, Helvetica, sans-serif;
        margin-left: 12px;
      }

      #form-header {
        font-size: 18pt;
        font-weight: bold;
        margin-bottom: 8px;
      }

      #submit-btn {
        background-color: rgb(27, 135, 27);
        border: none;
        font-size: 15pt;
        font-weight: 700;
        color: #e2e2e2;
        margin: 9px 10px;
        border-radius: 8px;
        padding: 6px 10px;
        transition: all 0.3s ease;
        margin-top: 16px;
      }

      #submit-btn:hover {
        background-color: rgb(5, 97, 5);
      }

      #submit-btn:focus {
        background-color: rgb(5, 80, 5);
      }

      #login-link {
        margin-top: 16px;
      }

      #login-link a {
        color: #008dd3;
      }
    </style>
  </head>
  <body>
    <div id="center-column">
      <form id="signup-form">
        <div id="form-header">Create an Account</div>
        <input
          type="email"
          name="email"
          id="email-input"
          placeholder="Email"
          required
        />
        <div id="email-err" class="form-err"></div>
        <input
          type="text"
          name="username"
          id="username-input"
          placeholder="Username"
          required
        />
        <div id="username-err" class="form-err"></div>
        <input
          type="password"
          name="password"
          id="passworld-input"
          placeholder="Password"
          required
        />
        <div id="password-err" class="form-err"></div>
        <input type="submit" value="Sign Up" id="submit-btn" />
        <p id="login-link">Already have an account? <a href="/login">Log in.</a></p>
      </form>
      <div id="out"></div>
    </div>

    <script>
      const emailErr = document.getElementById("email-err");
      const usernameErr = document.getElementById("username-err");
      const passwordErr = document.getElementById("password-err");
      const out = document.getElementById("out");

      $("#signup-form").submit(async (e) => {
        e.preventDefault();

        const form = new FormData(e.target);
        const formData = Object.fromEntries(form.entries());

        emailErr.textContent = "";
        usernameErr.textContent = "";
        passwordErr.textContent = "";

        const email = formData.email.trim();
        const username = formData.username;
        const password = formData.password;

        try {
          const res = await fetch("/signup", {
            method: "POST",
            body: JSON.stringify({ email, username, password }),
            headers: { "Content-Type": "application/json" },
          });
          const data = await res.json();
          console.log(JSON.stringify(data));
          if (data.errors) {
            //$(out).append("<br>" + JSON.stringify(data));
            emailErr.textContent = data.errors.email;
            usernameErr.textContent = data.errors.username;
            passwordErr.textContent = data.errors.password;
          }
          if (data.user) {
            location.assign("/decks");
          }
        } catch (err) {
          console.log(err);
          //$(out).append("<br>" + JSON.stringify(err));
        }
      });
    </script>
  </body>
</html>
